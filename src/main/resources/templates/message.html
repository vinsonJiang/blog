<!DOCTYPE html>
<html>
	<head>
		<base href="<%= basePath %>">

		<title>message</title>

		<!-- meta -->
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1">

	    <!-- css -->
		<link rel="stylesheet" href="/plugins/font-awesome/4.7.0/css/font-awesome.min.css">
	    <link href="https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet">
		<link rel="stylesheet" href="/css/v.css">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="stylesheet" href="/css/article.css">
	    <style>
	    	.grid-col-content {
		    	width: 100%;
			}
			.comment-form-footer a:hover {
			    color: white;
			}
	    </style>
	</head>
	
	<body>

		<header class="grid-header" id="header">
		    <div class="m-progress"></div>
		    <div class="grid-container-fixed grid-container-inner">
	        	<div class="m_logo" style="float: left;">
					<h1 style="padding-top: 10px;"><a href="blog">${application.brand}</a></h1>
				</div>
	            <span class="u-loading"></span>
	            <nav class="m-nav" style="">
	                <ul>
	                    <li class=""><a href="/" data-title="首页">首页</a></li>
	                    <li><a href="/blog" rel="pjax" data-title="作品">作品</a></li>
	                    <li class=""><a href="/blog" rel="pjax" data-title="博客">博客</a></li>
	                    <li class="current"><a href="/message" rel="pjax" data-title="留言">留言</a></li>
	                    <li class="">
	                    	<a>资源</a><span class="icon-drop"></span>
	                    </li>
	                </ul>
	            </nav>
	            <a class="u-icon-menu"><i></i><i></i><i></i></a>
		    </div>
		</header>
		
		<a class="u-back-up" id="js-backup-top"></a>
		
		<!--右键界面-->
		<div class="u-click-right-wrap" id="smohan-right-click" style="display: none; left: 1220px; top: 120px;"><ul><li><a class="js-smohan-right-click-forward disabled" rel="pjax" href="" data-title=""><span class="u-icon icon-p-forward"></span><span>前进</span></a></li><li><a class="js-smohan-right-click-back disabled" rel="pjax" href="" data-title=""><span class="u-icon icon-p-back"></span><span>后退</span></a></li><li><a class="js-smohan-right-click-reload" rel="pjax" href="http://www.smohan.net/blog" data-title="博客"><span class="u-icon icon-refresh"></span><span>刷新</span></a></li><li><a href="http://www.smohan.net/about.html" data-title="关于水墨寒" rel="pjax" class="js-smohan-right-click-about"><span class="u-icon icon-about"></span><span>关于</span></a></li></ul></div>
		
		<div id="doc-container" class="doc-container" style="min-height:900px;">
		    <div class="grid-container-fixed">
		        <div class="grid-col-content">
		            <div class="m-inner">		            	
		            	<div class="comments-body">
		            		<h3 class="comment-title">留言<a style="font-weight:200;">${count }</a></h3> 
		                	<form class="comment-form">
		                		<fieldset class="comment-form-group">
		                			<div class="v-input-group">
		                				<label class="v-input-group--cell v-button readonly">昵称</label> 
		                				<input type="text" id="nickname" placeholder="个性昵称" spellcheck="false" maxlength="20" class="v-input-group--cell comments-field-short v-input js-comment-form-nick">
		                			</div>
		                		</fieldset> 
                				<fieldset class="comment-form-group">
                					<div class="v-input-group">
                					<label class="v-input-group--cell v-button readonly">邮箱</label> 
                					<input type="text" id="email" placeholder="电子邮箱" spellcheck="false" maxlength="50" class="v-input-group--cell comments-field-short v-input js-comment-form-email"></div>
                				</fieldset> 
                				<fieldset class="comment-form-group">
                					<div class="comment-form-content">
                						<textarea rows="3" id="content" placeholder="畅所欲言~" spellcheck="false" class="v-input js-comment-form-contents"></textarea>
	                					<div class="comment_release_success" style="display: none;">
		                					<span>
		                						<i class="mo-ico-check"></i>
		                						<i>发布成功!</i>
		                					</span>
	                					</div> 
	                					<div class="comment-form-footer">
	                						<div class="emoji-dropdown">
	                						<a class="emoji-toggle"><i class="icon-emoji"></i></a> 
	                						<div class="emoji-wrapper" style="display: none;">
	                							<ul class="emojis">
	                								<li title="快哭了" class="emoji"><img src="" alt="快哭了"></li>
	                							</ul>
	                						</div>
	                					</div> 
	                					<span class="mo-right mo-text-negative" style="display: none;"></span> 
	                					<a onclick="submit();" class="v-button v-button--app">发 布</a>
	                				</div>
                					</div>
                				</fieldset>
                			</form> 
	                		<div class="comments-list">
	                			<c:forEach var="message" items="${messages}" varStatus="status">
	                			<div class="comment-item">
	                				<figure class="comment-item-avatar"><img src="img/default.gif" alt="${message.nickname }"></figure> 
	                				<main class="comment-item-body">
	                					<h6 class="comment-item-info mo-clearfix">
	                						<strong class="mo-text-negative">${message.nickname }</strong>
	                						<time>${message.sendDate }</time>
	                					</h6> 
	                					<div class="comment-item-content">
	                						<div class="mo-inline">${message.content }</div> 
	                						<!-- <a class="comment-item-reply_button">[回复]</a> -->
	                					</div> 
	                					<!----> <!---->
	                				</main>
	                			</div>
	                			</c:forEach>
	                			<button disabled="disabled" class="comment-list-loader" style="">没有更多观点了...</button>
	                		</div>
		                </div>
		            
		            </div>
		        </div>

			</div>
		</div>
	
		<footer id="site-footer">
			<div class="grid-container-inner">
				<div class="row">
					<div class="col-md-12">
						<p class="copyright">${application.copyright}</p>
					</div>
				</div>
			</div>
		</footer>
	</body>
	<!-- js -->
	<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
	
	<script src="/js/header.js"></script>
	<script src="/js/script.js"></script>
	<script src="https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js"></script>
	
	<script>
	    function submit() {
	        var nickname = $("#nickname").val()
	        var email = $("#email").val()
	        var content = $("#content").val()
			var email = $.trim($("#email").val());
			var reg = /^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/;
		    if(email==null||email.length==0)
		    {
		        alert("邮箱不能为空");
		        return false;
		    }
		    else if(!reg.test(email))
		    {
		    	alert("邮箱格式错误");
		        return false;
		    }
	        $.ajax({
	            url: "/message",
	            type: "post",
	            data: { nickname: nickname, email: email, content: content },
	            success: function (data) {
	                if (data.status == "1") {
	                	if(!jQuery.isEmptyObject(data.result)){
	                    	showSuccess(data.result, function () {
	                        	window.location.reload();
	                        })
	                    }else{
	                    	showError("请求出错！");
	                    }
	                } else {
	                     showError(data.result);
	                }
	            }, error: function (error) {
	                showError("请求出错！")
	            }
	        })
	    }
	    
		function showError(msg) {
		    swal(msg, "", "error");
		}
		
		function showSuccess(msg, fu) {
		    swal({ title: msg, type: "success" }, function (ifConfirm) {
		        if (ifConfirm) {
		            fu();
		        }
		    });
		}
	</script>
	
</html>



